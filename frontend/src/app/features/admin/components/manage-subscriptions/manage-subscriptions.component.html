<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-black text-gray-900 dark:text-white mb-2">üì¶ Gestion des Abonnements</h1>
      <p class="text-gray-600 dark:text-gray-400">G√©rer les types et les plans d'abonnement</p>
    </div>
    <div class="flex gap-3">
      <button (click)="showCreateModal()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-semibold rounded-xl hover:shadow-lg transition-all duration-200">
        <i class="fa-solid fa-plus mr-2"></i>
        Nouvel abonnement
      </button>
    </div>
  </div>

  <!-- Loading / Error -->
  <div *ngIf="loading" class="p-12 text-center">
    <i class="fa-solid fa-spinner fa-spin text-4xl text-blue-600"></i>
    <p class="text-gray-600 dark:text-gray-400 mt-4">Chargement...</p>
  </div>

  <div *ngIf="!loading && error" class="p-12 text-center">
    <i class="fa-solid fa-exclamation-triangle text-4xl text-red-600"></i>
    <p class="text-red-600 mt-4">{{ error }}</p>
  </div>

  <!-- Subscriptions Grid -->
  <div *ngIf="!loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let sub of subscriptions" class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-soft border border-gray-100 dark:border-gray-700 hover:shadow-lg transition-all duration-200">
      <!-- Header with status badge -->
      <div class="flex items-start justify-between mb-4">
        <div>
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-1">Abonnement {{ sub.nom }}</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">{{ sub.description || 'Pour les ' + sub.nom.toLowerCase() + ' utilisateurs' }}</p>
        </div>
        <span 
          class="px-3 py-1 rounded-full text-xs font-bold"
          [ngClass]="sub.estActif ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-400'">
          {{ sub.estActif ? 'Actif' : 'Inactif' }}
        </span>
      </div>

      <!-- Price -->
      <div class="mb-6">
        <div class="flex items-baseline gap-2">
          <span class="text-4xl font-black text-blue-600 dark:text-blue-400">{{ sub.cout }} FCFA</span>
          <span class="text-gray-500 dark:text-gray-400">/ {{ sub.duree }} jours</span>
        </div>
      </div>

      <!-- Features -->
      <div class="space-y-3 mb-6">
        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
          <i class="fa-solid fa-clock w-5"></i>
          <span>Dur√©e: {{ sub.duree }} jours</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
          <i class="fa-solid fa-search w-5"></i>
          <span>Recherches max: {{ sub.nombreScrapingMax }}</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex items-center justify-center gap-3 pt-2">
        <button 
          (click)="viewDetails(sub)"
          class="w-10 h-10 rounded-lg bg-gray-700 dark:bg-gray-600 hover:bg-gray-600 dark:hover:bg-gray-500 text-white flex items-center justify-center transition-all duration-200 hover:scale-110"
          title="Voir d√©tails">
          <i class="fa-solid fa-eye text-lg"></i>
        </button>
        <button 
          (click)="editSubscription(sub)"
          class="w-10 h-10 rounded-lg bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center transition-all duration-200 hover:scale-110"
          title="Modifier">
          <i class="fa-solid fa-pen text-lg"></i>
        </button>
        <button 
          (click)="toggleSubscription(sub)"
          class="w-10 h-10 rounded-lg text-white flex items-center justify-center transition-all duration-200 hover:scale-110"
          [ngClass]="sub.estActif ? 'bg-orange-500 hover:bg-orange-600' : 'bg-green-500 hover:bg-green-600'"
          [title]="sub.estActif ? 'D√©sactiver' : 'Activer'">
          <i class="fa-solid text-lg" [ngClass]="sub.estActif ? 'fa-ban' : 'fa-check'"></i>
        </button>
        <button 
          (click)="deleteSubscription(sub)"
          class="w-10 h-10 rounded-lg bg-red-600 hover:bg-red-700 text-white flex items-center justify-center transition-all duration-200 hover:scale-110"
          title="Supprimer">
          <i class="fa-solid fa-trash text-lg"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Edit/Create Modal -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="closeModal()">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
          {{ isEditMode ? 'Modifier l\'abonnement' : 'Nouvel abonnement' }}
        </h2>
        <button (click)="closeModal()" class="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <i class="fa-solid fa-times text-xl"></i>
        </button>
      </div>

      <form (ngSubmit)="saveSubscription()" #subForm="ngForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <!-- Nom -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Nom de l'abonnement *
            </label>
            <input 
              type="text" 
              [(ngModel)]="currentSubscription.nom" 
              name="nom" 
              required
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
          </div>

          <!-- Type -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Type *
            </label>
            <select 
              [(ngModel)]="currentSubscription.type" 
              name="type" 
              required
              (ngModelChange)="onTypeChange($event)"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
              <option value="MENSUEL">Mensuel</option>
              <option value="TRIMESTRIEL">Trimestriel</option>
              <option value="ANNUEL">Annuel</option>
            </select>
          </div>

          <!-- Co√ªt -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Co√ªt (FCFA) *
            </label>
            <input 
              type="number" 
              [(ngModel)]="currentSubscription.cout" 
              name="cout" 
              required 
              min="0"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
          </div>

          <!-- Dur√©e -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Dur√©e (jours) *
            </label>
            <input 
              type="number" 
              [(ngModel)]="currentSubscription.duree" 
              name="duree" 
              required 
              min="1"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
          </div>

          <!-- Nombre Scraping Max -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
              Recherches max *
            </label>
            <input 
              type="number" 
              [(ngModel)]="currentSubscription.nombreScrapingMax" 
              name="nombreScrapingMax" 
              required 
              min="1"
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
          </div>
        </div>

        <!-- Description -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
            Description
          </label>
          <textarea 
            [(ngModel)]="currentSubscription.description" 
            name="description" 
            rows="3"
            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 outline-none resize-none">
          </textarea>
        </div>

        <!-- Active Checkbox -->
        <div class="mb-6">
          <label class="flex items-center gap-2 cursor-pointer">
            <input 
              type="checkbox" 
              [(ngModel)]="currentSubscription.estActif" 
              name="estActif"
              class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
            <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Abonnement actif</span>
          </label>
        </div>

        <!-- Actions -->
        <div class="flex gap-3 justify-end">
          <button 
            type="button" 
            (click)="closeModal()"
            class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
            Annuler
          </button>
          <button 
            type="submit" 
            [disabled]="!subForm.valid"
            class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
            {{ isEditMode ? 'Mettre √† jour' : 'Cr√©er' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Details Modal -->
  <div *ngIf="showDetailsModal && selectedSubscription" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="closeDetailsModal()">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
          D√©tails de l'abonnement
        </h2>
        <button (click)="closeDetailsModal()" class="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <i class="fa-solid fa-times text-xl"></i>
        </button>
      </div>

      <div class="space-y-6">
        <!-- Header with status -->
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-3xl font-black text-gray-900 dark:text-white mb-2">{{ selectedSubscription.nom }}</h3>
            <p class="text-gray-600 dark:text-gray-400">{{ selectedSubscription.description || 'Aucune description' }}</p>
          </div>
          <span 
            class="px-4 py-2 rounded-full text-sm font-bold"
            [ngClass]="selectedSubscription.estActif ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-400'">
            {{ selectedSubscription.estActif ? 'Actif' : 'Inactif' }}
          </span>
        </div>

        <!-- Price Card -->
        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-6 border border-blue-100 dark:border-blue-800">
          <div class="flex items-baseline gap-3 mb-2">
            <span class="text-5xl font-black text-blue-600 dark:text-blue-400">{{ selectedSubscription.cout }} FCFA</span>
            <span class="text-xl text-gray-600 dark:text-gray-400">/ {{ selectedSubscription.duree }} jours</span>
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-400">Type: {{ selectedSubscription.type }}</p>
        </div>

        <!-- Features Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center">
                <i class="fa-solid fa-clock text-white"></i>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Dur√©e</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white">{{ selectedSubscription.duree }} jours</p>
              </div>
            </div>
          </div>

          <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-lg bg-green-600 flex items-center justify-center">
                <i class="fa-solid fa-search text-white"></i>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Recherches max</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white">{{ selectedSubscription.nombreScrapingMax }}</p>
              </div>
            </div>
          </div>

          <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-lg bg-orange-600 flex items-center justify-center">
                <i class="fa-solid fa-coins text-white"></i>
              </div>
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Co√ªt</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white">{{ selectedSubscription.cout }} FCFA</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Button -->
      <div class="flex gap-3 justify-end mt-6">
        <button 
          (click)="closeDetailsModal()"
          class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
          Fermer
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteModal && subscriptionToDelete" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="closeDeleteModal()">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md" (click)="$event.stopPropagation()">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
          <i class="fa-solid fa-trash text-red-600 dark:text-red-400 text-xl"></i>
        </div>
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">
          Confirmer la suppression
        </h2>
      </div>
      
      <p class="text-gray-600 dark:text-gray-400 mb-6">
        √ätes-vous s√ªr de vouloir supprimer l'abonnement <strong class="text-gray-900 dark:text-white">{{ subscriptionToDelete.nom }}</strong> ({{ subscriptionToDelete.cout }} FCFA) ? 
        Cette action est irr√©versible et affectera tous les utilisateurs actuellement abonn√©s √† ce plan.
      </p>

      <div class="flex gap-3 justify-end">
        <button 
          (click)="closeDeleteModal()"
          class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200">
          Annuler
        </button>
        <button 
          (click)="confirmDelete()"
          class="px-6 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors duration-200">
          Supprimer
        </button>
      </div>
    </div>
  </div>
</div>
